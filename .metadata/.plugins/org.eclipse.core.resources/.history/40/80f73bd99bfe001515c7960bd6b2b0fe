package com.cathacks2016.proxy;

import java.io.IOException;
import java.util.HashMap;
import java.util.Vector;

public class Runner {
	
	public static final int PROXY_SERVER_PORT = 22754;
	public static final int PROXY_CLIENT_PORT = 22753;

	public static void main( String[] args ){
		try {
			System.out.println("Server Starting!");
			
			HashMap< String, Vector<ClientConnection> > client_socket_map = new HashMap<>();
			HashMap< String, ServerConnection > server_socket_map = new HashMap<>();
			
			client_socket_map.put("default", new Vector<ClientConnection>());
			
			// Create threads
			ClientConnectionListener client_server = new ClientConnectionListener( client_socket_map );
			ServerConnectionListener server_server = new ServerConnectionListener( server_socket_map );

			ServerManager server_manager = new ServerManager( server_socket_map, client_socket_map );
			DefaultClientManager default_client_manager = new DefaultClientManager( server_socket_map, client_socket_map );
			
			// Start Threads
			client_server.start();
			server_server.start();
			default_client_manager.start();
			
			// Join Threads into main thread
			default_client_manager.join();
			client_server.join();
			server_server.join();
			
			// Be friendly!
			System.out.println("Server Closing!");
			
		} catch (IOException | InterruptedException e) {
			e.printStackTrace();
		}
	}
	
}
